/* http://jscompress.com/ */
function CPolygon(e){$.fx.speeds._default=1e3;this.isResizable=true;this.init(e);this.shapeMode=false;this.inEdition=false;this.isMoving=false;this.active=false;this.data={};this.dataActive={};this.coordsX=new Array;this.coordsY=new Array;this.x=parseInt(e.getAttribute("x"));this.y=parseInt(e.getAttribute("y"));this.width=parseInt(e.getAttribute("width"));this.height=parseInt(e.getAttribute("height"));this.shapeIndex=0;if(_editMode){if(typeof design!=="undefined")this.zone=design.currentZone;else if(typeof subpages!=="undefined")this.zone=subpages.currentSubPage}else this.zone=design_view.currentZone;this.index=$("#shapes_"+this.zone).children("area[shape='poly']").length;$("#shapes_"+this.zone).append('<area id="poly_'+this.zone+this.index+'" shape="poly" coords="0,0">');if(_editMode){this.newCoordsX=new Array;this.newCoordsY=new Array;this.newWidth=this.width;this.newHeight=this.height;$(this.div).dblclick(function(e){var t=this.owner;if(t.coordsX.length==0){t.shapeIndex=0;t.shapeMode=true;t.coordsX[0]=Math.round(e.pageX-t.div.offset().left);t.coordsY[0]=Math.round(e.pageY-t.div.offset().top);updateCoordinates(t);var n=(t.coordsX[0]+t.x).toString()+","+(t.coordsY[0]+t.y).toString();$("#shapes_"+t.zone).append('<area id="poly_'+t.zone+t.index+"_tmp"+t.shapeIndex+'" shape="poly" coords="'+n+'">')}else{if(t.shapeMode){buildPolygon(t);t.shapeMode=false}editPolygon(t)}updatePolygonState(t)});$(this.div).click(function(){if(this.owner.shapeMode){var e=this.owner;e.shapeIndex++;updateCoordinates(e);var t=(e.coordsX[e.shapeIndex]+e.x).toString()+","+(e.coordsY[e.shapeIndex]+e.y).toString();$("#shapes_"+e.zone).append('<area id="poly_'+e.zone+e.index+"_tmp"+e.shapeIndex+'" shape="poly" coords="'+t+'">')}});$(this.div).mousemove(function(e){if(this.owner.shapeMode){var t=this.owner;var n=Math.round(e.pageX-t.div.offset().left);var r=Math.round(e.pageY-t.div.offset().top);if(n>t.width||r>t.height)return;t.coordsX[t.shapeIndex+1]=n;t.coordsY[t.shapeIndex+1]=r;var i=(t.coordsX[t.shapeIndex]+t.x).toString()+","+(t.coordsY[t.shapeIndex]+t.y).toString()+","+(t.coordsX[t.shapeIndex+1]+t.x).toString()+","+(t.coordsY[t.shapeIndex+1]+t.y).toString();$("#poly_"+t.zone+t.index+"_tmp"+t.shapeIndex).attr("coords",i);$("#poly_"+t.zone+t.index+"_tmp"+t.shapeIndex).data("maphilight",{alwaysOn:true}).trigger("alwaysOn.maphilight")}});$(this.div).on("remove",function(){var e=this.owner;$("#poly_"+e.zone+e.index).remove();$("#bgImage_"+e.zone).maphilight()});var t=this;$("#mainContent").scroll(function(){clearTimeout($.data(this,"scrollTimer"));$.data(this,"scrollTimer",setTimeout(function(){if(t.inEdition){exitPolygonEdit(t);editPolygon(t)}},250))})}else{var t=this;$("#poly_"+this.zone+this.index).click(function(){var e=true;var n;if(t.active){if(t.dataActive.neverOn)return;if(t.conf.getAttribute("active-goto")!=""){if(t.conf.getAttribute("confirm")=="true")e=confirm(tr("confirm the command"));if(e)gotoZone(t.conf.getAttribute("active-goto"));return}n=$("actionlist[id=active-action]",t.conf)}else{if(t.data.neverOn)return;if(t.conf.getAttribute("inactive-goto")!=""){if(t.conf.getAttribute("confirm")=="true")e=confirm(tr("confirm the command"));if(e)gotoZone(t.conf.getAttribute("inactive-goto"));return}n=$("actionlist[id=inactive-action]",t.conf)}if(n.children().length>0){if(t.conf.getAttribute("confirm")=="true")e=confirm(tr("confirm the command"));if(e)EIBCommunicator.executeActionList(n)}})}this.refreshHTML()}function buildPolygon(e){var t="";$(e.coordsX).each(function(n,r){t=t+(r+e.x).toString()+","+(e.coordsY[n]+e.y).toString()+","});t=t.substring(0,t.length-1);$("#poly_"+e.zone+e.index).attr("coords",t);$("[id^=poly_"+e.zone+e.index+"_tmp]").remove()}function exitPolygonEdit(e){$(".cornerResizers",e.div).remove();$(".medianResizers",e.div).remove();e.inEdition=false;if(e.shapeMode){$(e.div).click();$("[id^=poly_"+e.zone+e.index+"_tmp]").remove();removePoint(e,e.shapeIndex+1);e.shapeMode=false}}function editPolygon(e){e.inEdition=true;$(e.coordsX).each(function(t,n){var r=$('<div id="corner_'+t+'" class="cornerResizers"></div>');var i=$('<div id="inter_'+t+'" class="medianResizers"></div>');e.div.append(r);e.div.append(i);var s=parseInt(r.css("width").replace(/px$/,""));if(s%2!=0){s++;r.css("width",s.toString()+"px")}var u=parseInt(r.css("height").replace(/px$/,""));if(u%2!=0){u++;r.css("height",u.toString()+"px")}var a=parseInt(i.css("width").replace(/px$/,""));if(a%2!=0){a++;i.css("width",a.toString()+"px")}var f=parseInt(i.css("height").replace(/px$/,""));if(f%2!=0){f++;i.css("height",f.toString()+"px")}r.css("left",Math.round(n-s/2-1)+"px");r.css("top",Math.round(e.coordsY[t]-u/2-1)+"px");if(t==e.coordsX.length-1){i.css("left",Math.round((n+e.coordsX[0])/2-a/2-1)+"px");i.css("top",Math.round((e.coordsY[t]+e.coordsY[0])/2-f/2-1)+"px")}else{i.css("left",Math.round((n+e.coordsX[t+1])/2-a/2-1)+"px");i.css("top",Math.round((e.coordsY[t]+e.coordsY[t+1])/2-f/2-1)+"px")}var l=[1,1];if(e.coordsX.length>1){var c=Math.round(e.div.offset().left)-s/2-1;var h=Math.round(e.div.offset().top)-u/2-1;var p=Math.round(e.div.offset().left+e.div.width())-s/2;var d=Math.round(e.div.offset().top+e.div.height())-u/2;r.draggable({containment:[c,h,p,d],scroll:false,opacity:.5,zIndex:500,delay:50,grid:l,drag:function(n,r){var i=Math.round(r.position.left)+s/2+1;var l=Math.round(r.position.top)+u/2+1;updatePoint(e,t,i,l);if(t==0){$("#inter_"+(e.coordsX.length-1)).css("left",Math.round((i+e.coordsX[e.coordsX.length-1])/2-a/2-1)+"px");$("#inter_"+(e.coordsY.length-1)).css("top",Math.round((l+e.coordsY[e.coordsY.length-1])/2-f/2-1)+"px")}else{$("#inter_"+(t-1)).css("left",Math.round((i+e.coordsX[t-1])/2-a/2-1)+"px");$("#inter_"+(t-1)).css("top",Math.round((l+e.coordsY[t-1])/2-f/2-1)+"px")}if(t==e.coordsX.length-1){$("#inter_"+t).css("left",Math.round((i+e.coordsX[0])/2-a/2-1)+"px");$("#inter_"+t).css("top",Math.round((l+e.coordsY[0])/2-f/2-1)+"px")}else{$("#inter_"+t).css("left",Math.round((i+e.coordsX[t+1])/2-a/2-1)+"px");$("#inter_"+t).css("top",Math.round((l+e.coordsY[t+1])/2-f/2-1)+"px")}},stop:function(n,r){var i=Math.round(n.pageX-e.div.offset().left);var a=Math.round(n.pageY-e.div.offset().top);fixPoint(e,t,i,a);var f=Math.round(r.position.left)+s/2+1;var l=Math.round(r.position.top)+u/2+1;fixPoint(e,t,f,l);updateCoordinates(e)}});r.contextmenu(function(){var e=$(this).parent()[0].owner;removePoint(e,t);updateCoordinates(e);exitPolygonEdit(e);editPolygon(e);return false})}var v=Math.round(e.div.offset().left)-a/2-1;var m=Math.round(e.div.offset().top)-f/2-1;var g=Math.round(e.div.offset().left+e.div.width())-a/2;var y=Math.round(e.div.offset().top+e.div.height())-f/2;i.draggable({containment:[v,m,g,y],scroll:false,opacity:.5,zIndex:500,delay:50,grid:l,start:function(n,r){var i=Math.round(r.position.left)+a/2+1;var s=Math.round(r.position.top)+f/2+1;e.coordsX.splice(t+1,0,i);e.coordsY.splice(t+1,0,s)},drag:function(n,r){var i=Math.round(r.position.left)+a/2+1;var s=Math.round(r.position.top)+f/2+1;updatePoint(e,t+1,i,s)},stop:function(n,r){var i=Math.round(n.pageX-e.div.offset().left);var s=Math.round(n.pageY-e.div.offset().top);fixPoint(e,t+1,i,s);updateCoordinates(e);exitPolygonEdit(e);editPolygon(e)}})})}function getCoordinates(e){var t=e.conf.getAttribute("x-coords").split(",");var n=e.conf.getAttribute("y-coords").split(",");if(t[0].length==0||n[0].length==0)return 0;var r=0;e.coordsX.length=0;e.coordsY.length=0;var i=t.length>n.length?t.length:n.length;for(r=0;r<i;r++){var s=parseInt(t[r]);var o=parseInt(n[r]);if(isNaN(s))s=0;if(isNaN(o))o=0;if(s<0)s=0;else if(s>e.width)s=parseInt(e.width);if(o<0)o=0;else if(o>e.height)o=parseInt(e.height);e.coordsX.push(s);e.coordsY.push(o)}return i}function fixPoint(e,t,n,r){var i=false;if(e.coordsX[t]<=0||n<=0){e.coordsX[t]=0;i=true}else if(e.coordsX[t]>=e.width||n>=e.width){e.coordsX[t]=e.width;i=true}if(e.coordsY[t]<=0||r<=0){e.coordsY[t]=0;i=true}else if(e.coordsY[t]>=e.height||r>=e.height){e.coordsY[t]=e.height;i=true}if(i)updatePoint(e,t,e.coordsX[t],e.coordsY[t])}function updateCoordinates(e){var t="";var n="";$(e.coordsX).each(function(r,i){t=t+i+",";n=n+e.coordsY[r]+","});t=t.substring(0,t.length-1);n=n.substring(0,n.length-1);e.conf.setAttribute("x-coords",t);e.conf.setAttribute("y-coords",n);$("input[name='x-coords']","#tab-design-widget-properties tbody").val(t);$("input[name='y-coords']","#tab-design-widget-properties tbody").val(n)}function updatePosition(e,t,n){e.x=t;e.y=n;if(e.coordsX.length==0)return;var r="";$(e.coordsX).each(function(i,s){r=r+(t+s).toString()+","+(n+e.coordsY[i]).toString()+","});r=r.substring(0,r.length-1);$("#poly_"+e.zone+e.index).attr("coords",r);updatePolygonState(e)}function removePoint(e,t){var n="";e.coordsX.splice(t,1);e.coordsY.splice(t,1);$(e.coordsX).each(function(t,r){n=n+(r+e.x).toString()+","+(e.coordsY[t]+e.y).toString()+","});n=n.substring(0,n.length-1);$("#poly_"+e.zone+e.index).attr("coords",n);updatePolygonState(e)}function updatePoint(e,t,n,r){var i="";e.coordsX[t]=n;e.coordsY[t]=r;$(e.coordsX).each(function(t,n){i=i+(n+e.x).toString()+","+(e.coordsY[t]+e.y).toString()+","});i=i.substring(0,i.length-1);$("#poly_"+e.zone+e.index).attr("coords",i);updatePolygonState(e)}function updateSize(e,t,n){var r="";var i=e.width==0?0:t/e.width;var s=e.height==0?0:n/e.height;e.newWidth=t;e.newHeight=n;if(e.coordsX.length==0)return;$(e.coordsX).each(function(t,n){var u=Math.round(i*n);var a=Math.round(s*e.coordsY[t]);e.newCoordsX[t]=u;e.newCoordsY[t]=a;r=r+(u+e.x).toString()+","+(a+e.y).toString()+","});r=r.substring(0,r.length-1);$("#poly_"+e.zone+e.index).attr("coords",r);updatePolygonState(e)}function updatePolygonState(e){if(_editMode){if(e.inEdition||e.isMoving){$("#poly_"+e.zone+e.index).data("maphilight",{alwaysOn:true}).trigger("alwaysOn.maphilight");return}if(e.conf.getAttribute("editmode-display-active")=="true")$("#poly_"+e.zone+e.index).data("maphilight",e.dataActive).trigger("alwaysOn.maphilight");else $("#poly_"+e.zone+e.index).data("maphilight",e.data).trigger("alwaysOn.maphilight");return}if(e.active)$("#poly_"+e.zone+e.index).data("maphilight",e.dataActive).trigger("alwaysOn.maphilight");else $("#poly_"+e.zone+e.index).data("maphilight",e.data).trigger("alwaysOn.maphilight");var t=false;if(e.active){if(!e.dataActive.neverOn){if(e.conf.getAttribute("active-goto")!="")t=true;else{var n=$("actionlist[id=active-action]",e.conf);if(n.children().length>0)t=true}}}else{if(!e.data.neverOn){if(e.conf.getAttribute("inactive-goto")!="")t=true;else{var n=$("actionlist[id=inactive-action]",e.conf);if(n.children().length>0)t=true}}}if(t)$("#poly_"+e.zone+e.index).css("cursor","pointer");else $("#poly_"+e.zone+e.index).css("cursor","default")}CPolygon.type="polygon";UIController.registerWidget(CPolygon);CPolygon.prototype=new CWidget;CPolygon.prototype.onSelect=function(){if(_editMode){if(this.div.parent().attr("id")=="widgetsubpagediv"){alert("This widget cannot be used on a subpage!");subpages.deleteWidget(this)}}};CPolygon.prototype.onDeSelect=function(){exitPolygonEdit(this);updatePolygonState(this)};CPolygon.prototype.onMoveStart=function(e,t){exitPolygonEdit(this);this.isMoving=true};CPolygon.prototype.onMove=function(e,t){updatePosition(this,e,t)};CPolygon.prototype.onMoveStop=function(e,t){this.isMoving=false;updatePolygonState(this)};CPolygon.prototype.onResizeStart=function(e,t){exitPolygonEdit(this);this.inEdition=true;this.newCoordsX.length=0;this.newCoordsY.length=0};CPolygon.prototype.onResize=function(e,t){updateSize(this,e,t)};CPolygon.prototype.onResizeStop=function(e,t){this.inEdition=false;this.coordsX.length=0;this.coordsY.length=0;Array.prototype.push.apply(this.coordsX,this.newCoordsX);Array.prototype.push.apply(this.coordsY,this.newCoordsY);updatePolygonState(this);updateCoordinates(this);this.width=this.newWidth;this.height=this.newHeight};CPolygon.prototype.refreshHTML=function(){if(_editMode){this.data.neverOn=false;this.data.alwaysOn=true}else{this.data.neverOn=this.conf.getAttribute("inactive-display")=="false"?true:false;this.data.alwaysOn=this.conf.getAttribute("inactive-alwayson")=="true"?true:false;this.data.fade=this.conf.getAttribute("inactive-fade")=="true"?true:false}this.data.fill=this.conf.getAttribute("background-fill")=="true"?true:false;var e=this.conf.getAttribute("background-color");if(e!="")this.data.fillColor=e.substring(1,e.length);var t=parseFloat(this.conf.getAttribute("background-opacity"));if(!isNaN(t)&&t>=0&&t<=1)this.data.fillOpacity=t;this.data.stroke=this.conf.getAttribute("stroke-display")=="true"?true:false;var n=this.conf.getAttribute("stroke-color");if(n!="")this.data.strokeColor=n.substring(1,n.length);var r=parseFloat(this.conf.getAttribute("stroke-opacity"));if(!isNaN(r)&&r>=0&&r<=1)this.data.strokeOpacity=r;var i=parseInt(this.conf.getAttribute("stroke-width"));if(!isNaN(i)&&i>=0&&i<=100)this.data.strokeWidth=i;this.data.shadow=this.conf.getAttribute("shadow-display")=="true"?true:false;var s=this.conf.getAttribute("shadow-x");if(!isNaN(s)&&s>=0&&s<=100)this.data.shadowX=s;var o=this.conf.getAttribute("shadow-y");if(!isNaN(o)&&o>=0&&o<=100)this.data.shadowY=o;var u=this.conf.getAttribute("shadow-radius");if(!isNaN(u)&&u>=0&&u<=100)this.data.shadowRadius=u;var a=this.conf.getAttribute("shadow-color");if(a!="")this.data.shadowColor=a.substring(1,a.length);var f=parseFloat(this.conf.getAttribute("shadow-opacity"));if(!isNaN(f)&&f>=0&&f<=1)this.data.shadowOpacity=f;if(this.conf.getAttribute("shadow-position")=="outside")this.data.shadowPosition="outside";else if(this.conf.getAttribute("shadow-position")=="inside")this.data.shadowPosition="inside";else this.data.shadowPosition="both";if(this.conf.getAttribute("shadow-from")=="stroke")this.data.shadowFrom="stroke";else if(this.conf.getAttribute("shadow-from")=="fill")this.data.shadowFrom="fill";else this.data.shadowFrom=false;if(_editMode){this.dataActive.neverOn=false;this.dataActive.alwaysOn=true}else{this.dataActive.neverOn=this.conf.getAttribute("active-display")=="false"?true:false;this.dataActive.alwaysOn=this.conf.getAttribute("active-alwayson")=="true"?true:false;this.dataActive.fade=this.conf.getAttribute("active-fade")=="true"?true:false}this.dataActive.fill=this.conf.getAttribute("background-active-fill")=="true"?true:false;e=this.conf.getAttribute("background-active-color");if(e!="")this.dataActive.fillColor=e.substring(1,e.length);t=parseFloat(this.conf.getAttribute("background-active-opacity"));if(!isNaN(t)&&t>=0&&t<=1)this.dataActive.fillOpacity=t;this.dataActive.stroke=this.conf.getAttribute("stroke-active-display")=="true"?true:false;n=this.conf.getAttribute("stroke-active-color");if(n!="")this.dataActive.strokeColor=n.substring(1,n.length);r=parseFloat(this.conf.getAttribute("stroke-active-opacity"));if(!isNaN(r)&&r>=0&&r<=1)this.dataActive.strokeOpacity=r;i=parseInt(this.conf.getAttribute("stroke-active-width"));if(!isNaN(i)&&i>=0&&i<=100)this.dataActive.strokeWidth=i;this.dataActive.shadow=this.conf.getAttribute("shadow-active-display")=="true"?true:false;s=this.conf.getAttribute("shadow-active-x");if(!isNaN(s)&&s>=0&&s<=100)this.dataActive.shadowX=s;o=this.conf.getAttribute("shadow-active-y");if(!isNaN(o)&&o>=0&&o<=100)this.dataActive.shadowY=o;u=this.conf.getAttribute("shadow-active-radius");if(!isNaN(u)&&u>=0&&u<=100)this.dataActive.shadowRadius=u;a=this.conf.getAttribute("shadow-active-color");if(a!="")this.dataActive.shadowColor=a.substring(1,a.length);f=parseFloat(this.conf.getAttribute("shadow-active-opacity"));if(!isNaN(f)&&f>=0&&f<=1)this.dataActive.shadowOpacity=f;if(this.conf.getAttribute("shadow-active-position")=="outside")this.dataActive.shadowPosition="outside";else if(this.conf.getAttribute("shadow-active-position")=="inside")this.dataActive.shadowPosition="inside";else this.dataActive.shadowPosition="both";if(this.conf.getAttribute("shadow-active-from")=="stroke")this.dataActive.shadowFrom="stroke";else if(this.conf.getAttribute("shadow-active-from")=="fill")this.dataActive.shadowFrom="fill";else this.dataActive.shadowFrom=false;var l=parseInt(this.conf.getAttribute("x"));this.x=isNaN(l)?this.x:l;var c=parseInt(this.conf.getAttribute("y"));this.y=isNaN(c)?this.y:c;if(getCoordinates(this)>0){updatePosition(this,this.x,this.y)}else{$("#poly_"+this.zone+this.index).attr("coords","0,0");$("#bgImage_"+this.zone).maphilight()}if(_editMode){var h=parseInt(this.conf.getAttribute("width"));this.newWidth=isNaN(h)||h<0?this.width:h;var p=parseInt(this.conf.getAttribute("height"));this.newHeight=isNaN(p)||p<0?this.height:p;if(this.width!=this.newWidth||this.height!=this.newHeight){updateSize(this,this.newWidth,this.newHeight);this.width=this.newWidth;this.height=this.newHeight}updateCoordinates(this)}updatePolygonState(this);if(_editMode)exitPolygonEdit(this);else $(this.div).hide()};CPolygon.prototype.updateObject=function(e,t){if(e==this.conf.getAttribute("feedback-object")){var n=t;var r=this.active;if(parseFloat(n))n=parseFloat(t);var i=this.conf.getAttribute("feedback-value");if(parseFloat(i))i=parseFloat(this.conf.getAttribute("feedback-value"));switch(this.conf.getAttribute("feedback-compare")){case"eq":this.active=n==i;break;case"neq":this.active=n!=i;break;case"gt":this.active=n>i;break;case"lt":this.active=n<i;break;case"gte":this.active=n>=i;break;case"lte":this.active=n<=i;break;default:this.active=false}if(this.active!=r)updatePolygonState(this)}}